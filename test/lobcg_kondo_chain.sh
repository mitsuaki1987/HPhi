#!/bin/sh -e

mkdir -p lobcg_kondo_chain/
cd lobcg_kondo_chain

cat > stan.in <<EOF
L = 4
model = "Kondo"
method = "CG"
lattice = "chain"
t = 1.0
J = 4.0
nelec = 4
2Sz = 0
exct = 2
EOF

${MPIRUN} ../../src/HPhi++ -s stan.in

# Check value

cat > reference.dat <<EOF
 0
  -12.6776213781764220 
  0.1072445462409922 
  0.0000000000000000 

 1
  -9.8347989641820277 
  0.4289751043491778 
  0.0000000000000000 
EOF
paste output/zvo_energy.dat reference.dat > paste1.dat
diff=`awk '
BEGIN{diff=0.0}
{diff+=sqrt(($2-$3)*($2-$3))}
END{printf "%8.6f", diff}
' paste1.dat`
echo "Diff output/zvo_energy.dat : " ${diff}
test "${diff}" = "0.000000"

# Check one-body G

cat > reference.dat <<EOF
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0856182891 0.0000000000
   0.5000000000 0.0000000000
   0.0856182891 0.0000000000
   -0.0000000000 -0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0856182891 -0.0000000000
   0.5000000000 0.0000000000
   0.0856182891 -0.0000000000
   0.0000000000 -0.0000000000
EOF
paste output/zvo_cisajs_eigen0.dat reference.dat > paste2.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste2.dat`
echo "Diff output/zvo_cisajs_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.4999999792 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.5000000208 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.1869257955 -0.0000000061
   0.4999999969 0.0000000000
   0.1869257323 -0.0000000254
   -0.0000000007 -0.0000000400
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.0000000000 0.0000000000
   0.1869257953 0.0000000331
   0.5000000096 0.0000000000
   0.1869257372 0.0000000379
   0.0000000052 -0.0000000455
EOF
paste output/zvo_cisajs_eigen1.dat reference.dat > paste3.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($5-$7)*($5-$7)+($6-$8)*($6-$8))}
END{printf "%8.6f", diff/NR}
' paste3.dat`
echo "Diff output/zvo_cisajs_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

# Check two-body G

cat > reference.dat <<EOF
   0.5000000000 0.0000000000
   0.0000000000 0.0000000000
   0.2334100529 0.0000000000
   0.2665899471 0.0000000000
   0.2520581283 0.0000000000
   0.2479418717 0.0000000000
   0.2334100529 0.0000000000
   0.2665899471 0.0000000000
   0.0144223177 0.0000000000
   0.4855776823 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.2484110693 0.0000000000
   0.2515889307 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.5000000000 0.0000000000
   -0.0331798943 0.0000000000
   0.0041162566 -0.0000000000
   -0.0331798943 0.0000000000
   -0.4711553647 -0.0000000000
   0.0182883790 -0.0000000000
   -0.0031778614 0.0000000000
   0.0182883790 -0.0000000000
   0.5000000000 0.0000000000
   -0.0331798943 -0.0000000000
   0.0041162566 0.0000000000
   -0.0331798943 -0.0000000000
   -0.4711553647 0.0000000000
   0.0182883790 0.0000000000
   -0.0031778614 -0.0000000000
   0.0182883790 0.0000000000
   0.0000000000 0.0000000000
   0.5000000000 0.0000000000
   0.2665899471 0.0000000000
   0.2334100529 0.0000000000
   0.2479418717 0.0000000000
   0.2520581283 0.0000000000
   0.2665899471 0.0000000000
   0.2334100529 0.0000000000
   0.4855776823 0.0000000000
   0.0144223177 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2515889307 0.0000000000
   0.2484110693 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.0144223177 0.0000000000
   0.4855776823 0.0000000000
   0.2591441895 0.0000000000
   0.2408558105 0.0000000000
   0.2484110693 0.0000000000
   0.2515889307 0.0000000000
   0.2341148537 0.0000000000
   0.2529380156 0.0000000000
   0.5000000000 0.0000000000
   0.0268111366 0.0000000000
   0.2341148537 0.0000000000
   0.2529380156 0.0000000000
   0.2506485267 0.0000000000
   0.2484345981 0.0000000000
   0.0182883790 0.0000000000
   -0.4711553647 0.0000000000
   0.0182883790 -0.0000000000
   -0.0031778614 0.0000000000
   -0.0188231620 -0.0000000000
   0.4731888634 0.0000000000
   -0.0188231620 0.0000000000
   0.0022139286 -0.0000000000
   0.0182883790 -0.0000000000
   -0.4711553647 -0.0000000000
   0.0182883790 0.0000000000
   -0.0031778614 -0.0000000000
   -0.0188231620 0.0000000000
   0.4731888634 0.0000000000
   -0.0188231620 -0.0000000000
   0.0022139286 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.4855776823 0.0000000000
   0.0144223177 0.0000000000
   0.2408558105 0.0000000000
   0.2591441895 0.0000000000
   0.2515889307 0.0000000000
   0.2484110693 0.0000000000
   0.2529380156 0.0000000000
   0.2341148537 0.0000000000
   0.0268111366 0.0000000000
   0.5000000000 0.0000000000
   0.2529380156 0.0000000000
   0.2341148537 0.0000000000
   0.2484345981 0.0000000000
   0.2506485267 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen0.dat reference.dat > paste5.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste5.dat`
echo "Diff output/zvo_cisajscktalt_eigen0.dat : " ${diff}
test "${diff}" = "0.000000"

cat > reference.dat <<EOF
   0.4999999792 0.0000000000
   0.0000000000 0.0000000000
   0.1340006013 0.0000000000
   0.3659993779 0.0000000000
   0.3498888217 0.0000000000
   0.1501111575 0.0000000000
   0.1340006261 0.0000000000
   0.3659993531 0.0000000000
   0.0631654757 0.0000000000
   0.4368344836 0.0000000000
   0.3285310600 0.0000000000
   0.1714689230 0.0000000000
   0.1618823105 0.0000000000
   0.3381176749 0.0000000000
   0.3285310423 0.0000000000
   0.1714689469 0.0000000000
   0.4999999792 0.0000000000
   0.1083653533 0.0000000556
   0.0422011955 -0.0000000021
   0.1083653272 -0.0000000438
   -0.2409145479 0.0000000142
   -0.0103254721 -0.0000000079
   -0.0266359304 0.0000000089
   -0.0103254825 -0.0000000013
   0.5000000208 0.0000000000
   0.1083653533 -0.0000000556
   0.0422011955 0.0000000021
   0.1083653272 0.0000000438
   -0.2409145479 -0.0000000142
   -0.0103254721 0.0000000079
   -0.0266359304 -0.0000000089
   -0.0103254825 0.0000000013
   0.0000000000 0.0000000000
   0.5000000208 0.0000000000
   0.3659994075 0.0000000000
   0.1340006133 0.0000000000
   0.1501112058 0.0000000000
   0.3498888149 0.0000000000
   0.3659993578 0.0000000000
   0.1340006630 0.0000000000
   0.4368345138 0.0000000000
   0.0631654919 0.0000000000
   0.1714689369 0.0000000000
   0.3285310866 0.0000000000
   0.3381176978 0.0000000000
   0.1618823287 0.0000000000
   0.1714689635 0.0000000000
   0.3285310640 0.0000000000
   0.3285310600 0.0000000000
   0.1714689369 0.0000000000
   0.0631654888 0.0000000000
   0.4368345081 0.0000000000
   0.3285310409 0.0000000000
   0.1714689560 0.0000000000
   0.1618823078 0.0000000000
   0.3381176890 0.0000000000
   0.1520225828 0.0000000000
   0.3026584351 0.0000000000
   0.4999999969 0.0000000000
   0.1072437948 0.0000000000
   0.1520226471 0.0000000000
   0.3026584219 0.0000000000
   0.3138448633 0.0000000000
   0.1695492458 0.0000000000
   -0.0103254721 0.0000000079
   -0.2409146091 -0.0000000178
   -0.0103254618 0.0000000070
   -0.0266359267 0.0000000281
   -0.0443381971 0.0000000104
   0.3927562021 0.0000000000
   -0.0443381731 0.0000000192
   0.0133913819 -0.0000000062
   -0.0103254721 -0.0000000079
   -0.2409146091 0.0000000178
   -0.0103254618 -0.0000000070
   -0.0266359267 -0.0000000281
   -0.0443381971 -0.0000000104
   0.3927562148 0.0000000000
   -0.0443381731 -0.0000000192
   0.0133913819 0.0000000062
   0.1714689230 0.0000000000
   0.3285310866 0.0000000000
   0.4368345223 0.0000000000
   0.0631654873 0.0000000000
   0.1714689935 0.0000000000
   0.3285310161 0.0000000000
   0.3381176781 0.0000000000
   0.1618823315 0.0000000000
   0.3026584478 0.0000000000
   0.1520225832 0.0000000000
   0.1072437948 0.0000000000
   0.5000000096 0.0000000000
   0.3026584287 0.0000000000
   0.1520226495 0.0000000000
   0.1695492501 0.0000000000
   0.3138448745 0.0000000000
EOF
paste output/zvo_cisajscktalt_eigen1.dat reference.dat > paste6.dat
diff=`awk '
BEGIN{diff=0.0} 
{diff+=sqrt(($9-$11)*($9-$11)+($10-$12)*($10-$12))}
END{printf "%8.6f", diff/NR}
' paste6.dat`
echo "Diff output/zvo_cisajscktalt_eigen1.dat : " ${diff}
test "${diff}" = "0.000000"

exit $?
