#!/bin/sh -e

mkdir -p fulldiag_genspingc_ladder
cd fulldiag_genspingc_ladder

cat > stan.in <<EOF
L = 1
W = 2
model = "SpinGC"
method = "FullDiag"
lattice = "ladder"
J0 = 1.0
J1 = 1.0
2S = 3
EOF

${MPIRUNFC} ../../src/HPhi++ -s stan.in

# Check value

cat > reference.dat <<EOF
  <H>         <N>        <Sz>       <S2>       <D>
   2.250000   2.000000  -1.000000   3.090909   0.000000
   2.479309   2.000000   0.000000   0.040818   0.000000
   3.250000   2.000000  -2.000000   6.000000   0.000000
   3.295837   2.000000   0.000000   2.007698   0.000000
   3.750000   2.000000   1.000000   2.857143   0.000000
   4.750000   2.000000   1.000000   6.000000   0.000000
   5.520691   2.000000   0.000000   5.959182   0.000000
   6.250000   2.000000  -1.000000   6.000000   0.000000
   6.250000   2.000000  -2.000000  12.000000   0.000000
   6.750000   2.000000  -3.000000  12.000000   0.000000
   7.750000   2.000000   2.000000   6.000000   0.000000
   7.750000   2.000000  -1.000000  10.909091   0.000000
   8.704163   2.000000   0.000000  11.992302   0.000000
   9.750000   2.000000   3.000000  12.000000   0.000000
  10.750000   2.000000   1.000000  11.142857   0.000000
  10.750000   2.000000   2.000000  12.000000   0.000000
EOF
paste output/zvo_phys.dat reference.dat > paste.dat
diff=`awk '
BEGIN{diff=0.0} 
NR>1{diff+=sqrt(($1-$6)*($1-$6))} 
END{printf "%8.6f", diff/NR}
' paste.dat`
test "${diff}" = "0.000000"

exit $?
